<!doctype html>
<html>
<head><meta charset="utf-8"><title>Admin - Topups</title><link rel="stylesheet" href="/css/style.css"></head>
<body>
  <h1>Admin Dashboard</h1>
  <div>
    <label>Username: <input id="username"></label>
    <label>Password: <input id="password" type="password"></label>
    <button id="loginBtn">Login</button>
  </div>
  <div id="controls" style="display:none;">
    <h2>คำขอเติมล่าสุด</h2>
    <table id="topupTable" border="1"></table>
  </div>
  <script>
    let token='';
    document.getElementById('loginBtn').onclick = async () => {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const r = await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});
      const j = await r.json();
      if(j.ok){ token = j.token; document.getElementById('controls').style.display='block'; loadTopups(); }
      else alert('Login failed');
    };
    async function loadTopups(){
      const r = await fetch('/api/topups?limit=200');
      const rows = await r.json();
      const table = document.getElementById('topupTable');
      table.innerHTML = '<tr><th>ID</th><th>Game</th><th>UID</th><th>Phone</th><th>Package</th><th>Amount</th><th>Status</th><th>Actions</th></tr>';
      rows.forEach(row=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${row.id}</td><td>${row.game}</td><td>${row.uid}</td><td>${row.phone}</td><td>${row.package_name}</td><td>${row.amount}</td><td>${row.status}</td>
          <td><button onclick="complete(${row.id})">Complete</button> <button onclick="cancel(${row.id})">Cancel</button></td>`;
        table.appendChild(tr);
      });
    }
    async function complete(id){
      await fetch('/api/topups/'+id+'/complete',{method:'POST',headers:{'x-auth-token':token}});
      loadTopups();
    }
    async function cancel(id){
      await fetch('/api/topups/'+id+'/cancel',{method:'POST',headers:{'x-auth-token':token}});
      loadTopups();
    }
  </script>
</body>
</html>
